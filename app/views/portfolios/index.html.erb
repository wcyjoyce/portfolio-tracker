<h1>Your Portfolios</h1>

<% unless @portfolios.empty? %>
  <div class="stats">
    <div class="stat">
      <div class="stat-header"><h5>Market Value</h5></div>
      <div class="stat-content"><%= number_with_delimiter(@user.market_value) %></div>
    </div>
    <div class="stat">
      <div class="stat-header"><h5>Total Return</h5></div>
      <div class="stat-content"><%= number_with_delimiter(@user.profit_amount) %> (<%= @user.profit_pct %>)</div>
    </div>
  </div>

  <div class="flex">
    <h5>As of <%= Time.now.strftime("%d %b %Y %H:%M %p") %></h5>
    <div class="action">
      <%= link_to "New Portfolio", new_portfolio_path, class: "button" %>
      <%= link_to "Refresh", portfolios_path, class: "button" %>
      <a href="/portfolios.csv" class="button">Export</a>
    </div>
  </div>

  <table class="table-responsive">
    <thead class="header">
      <th>Name</th>
      <th>Holdings</th>
      <th>Market Value</th>
      <th>Total Cost</th>
      <th>YTD</th>
      <th>Return</th>
      <th>Inception Date</th>
      <th></th>
    </thead>
    <tbody>
      <% @portfolios.order(created_at: :asc).each do |portfolio| %>
        <tr class="portfolio-row">
          <td><%= portfolio.name %></td>
          <td><%= portfolio.transactions.length %></td>
          <td><%= number_with_delimiter(portfolio.market_value) %></td>
          <td><%= number_with_delimiter(portfolio.total_cost) %></td>
          <td class="<%= portfolio.display(portfolio.ytd) %>"><%= portfolio.sign(portfolio.ytd) %></td>
          <td class="<%= portfolio.display(portfolio.profit_pct) %>"><%= portfolio.sign(portfolio.profit_pct) %> (<%= portfolio.sign(number_with_delimiter(portfolio.profit_amount)) %>)</td>
          <td><%= portfolio.inception %></td>
          <td>
            <div class="dropdown show">
              <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-caret-down"></i></a>

              <div class="dropdown-menu dropdown-menu-right">
                <div class="dropdown-item"><a href="#">Export</a></div>
                <div class="dropdown-item"><%= link_to "Show", portfolio_path(portfolio) %></div>
                <div class="dropdown-item"><%= link_to "Edit", edit_portfolio_path(portfolio) %></div>
                <div class="dropdown-item"><%= link_to "Delete", portfolio_path(portfolio), method: :delete, data: { confirm: "Are you sure you want to delete this portoflio?"} %></div>
              </div>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <div class="flex">
    <h5>You have not created any portfolios yet.</h5>
    <div class="action">
      <%= link_to "New Portfolio", new_portfolio_path, class: "button" %>
    </div>
  </div>
<% end %>

<%= content_for(:title, "Your Portfolios") %>
